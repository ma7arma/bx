<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<meta name="theme-color" content="#0b0f14"/>
<link rel="manifest" href="manifest.webmanifest">
<link rel="icon" href="assets/favicon.svg" type="image/svg+xml">
<title>Bixah ‚Äì QR Shock Demo (Mobile‚ÄëFirst)</title>
<style>
  :root{
    --bg:#0b0f14; --panel:#111722; --accent:#e53935; --ok:#2e7d32; --text:#e6eef7;
    --muted:#b7c2d0; --line:#1f2a3a; --chip:#132035;
    --radius:16px; --gap:14px; --pad:16px; --fs:16px; --fs-h1:22px; --fs-h2:18px;
  }
  @media (min-width:720px){
    :root{ --fs:17px; --fs-h1:26px; --fs-h2:20px; --gap:18px; --pad:20px; --radius:18px; }
  }
  html,body{margin:0;height:100%;background:var(--bg);color:var(--text);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;
    -webkit-text-size-adjust:100%; font-size:var(--fs);}
  .wrap{display:flex;min-height:100%;align-items:stretch;justify-content:center;padding:env(safe-area-inset-top) var(--pad) env(safe-area-inset-bottom);}
  .card{max-width:840px;width:100%;background:var(--panel);border-radius:var(--radius);
    box-shadow:0 10px 40px rgba(0,0,0,.45);padding:var(--pad);border:1px solid var(--line)}
  h1{margin:0 0 8px 0;font-size:var(--fs-h1);letter-spacing:.2px}
  h2{margin:12px 0 6px 0;font-size:var(--fs-h2)}
  p{line-height:1.6;margin:8px 0}
  .muted{color:var(--muted)}
  .grid{display:grid;grid-template-columns:1fr;gap:var(--gap)}
  @media (min-width:720px){ .grid.two {grid-template-columns:1fr 1fr} }
  .box{background:#0f1420;border:1px solid var(--line);border-radius:12px;padding:12px}
  .k{opacity:.8;font-size:.9em;letter-spacing:.3px}
  .v{font-weight:650;margin-top:6px;word-break:break-word}
  .cta{display:flex;flex-direction:column;gap:10px;margin-top:12px}
  @media (min-width:720px){ .cta{flex-direction:row} }
  .btn{appearance:none;border:none;border-radius:12px;padding:14px 16px;font-weight:700;cursor:pointer;width:100%}
  .primary{background:var(--ok);color:white}
  .ghost{background:transparent;border:1px solid #2a3648;color:#cfe3ff}
  .danger{background:var(--accent);color:white}
  .tag{display:inline-block;background:var(--chip);border:1px solid #294266;color:#bcd7ff;
    padding:4px 8px;border-radius:999px;font-size:12px;margin-left:8px}
  .note{font-size:.85em;opacity:.9;margin-top:8px}
  .modal{position:fixed;inset:0;background:rgba(7,10,14,.78);display:flex;align-items:flex-end;justify-content:center;padding:0;transition:.25s opacity}
  .sheet{width:100%;max-width:840px;background:var(--panel);border:1px solid var(--line);border-top-left-radius:16px;border-top-right-radius:16px;padding:16px;padding-bottom:calc(16px + env(safe-area-inset-bottom));}
  .sheet h2{margin:0 0 6px 0}
  .hidden{display:none}
  details{background:#0f1420;border:1px solid var(--line);border-radius:12px;padding:10px}
  details>summary{cursor:pointer;font-weight:700;outline:none;list-style:none}
  details>summary::-webkit-details-marker{display:none}
  video{width:100%;background:black;border-radius:12px;border:1px solid #1f2937}
  .hud{position:relative}
  .frame{position:absolute;inset:10px;border:2px dashed rgba(255,0,0,.6);border-radius:12px;pointer-events:none}
</style>
</head>
<body>
  <div id="modal" class="modal">
    <div class="sheet">
      <h2>We‚Äôve got you ‚Äî safely.</h2>
      <p class="muted">If this QR were malicious, this page could already be <strong style="color:#ffb3b3">profiling you</strong> or faking a login. This demo shows how little it takes ‚Äî with <strong>no storage and no network calls</strong>. Camera/Location are optional with your consent.</p>
      <div class="cta">
        <button class="btn danger" onclick="closeIntro()">Show me</button>
      </div>
      <p class="note">Tip: Avoid ‚Äúurgent‚Äù QR prompts; verify the URL first.</p>
    </div>
  </div>

  <div class="wrap">
    <main class="card">
      <h1>QR scams are easy. <span class="tag" id="modeTag">Shock mode</span></h1>
      <p class="muted">Mobile-optimized view. Expand sections below.</p>

      <details open>
        <summary>Instant fingerprint (no permission needed)</summary>
        <div class="grid" id="facts"></div>
      </details>

      <details>
        <summary>Deeper signals (unique ‚Äúsignature‚Äù hints)</summary>
        <div class="grid" id="deep"></div>
      </details>

      <details>
        <summary>Environment & behavior</summary>
        <div class="grid" id="env"></div>
      </details>

      <details>
        <summary>Live: behavior currently observable</summary>
        <div class="grid">
          <div class="box">
            <div class="k">Touch/mouse activity</div>
            <div class="v"><span id="mouseCount">0</span> moves ‚Ä¢ <span id="idle">0</span>s idle</div>
            <div class="note">Timing/paths can fingerprint users ‚Äî we‚Äôre just counting.</div>
          </div>
          <div class="box">
            <div class="k">Keystrokes on this page</div>
            <div class="v"><span id="keyCount">0</span> keys (<span id="lastKey">none</span>)</div>
            <div class="note">Key timing alone can be unique. We do <em>not</em> store text.</div>
          </div>
        </div>
      </details>

      <details>
        <summary>Optional (consent): camera + location</summary>
        <div class="grid two">
          <div class="box">
            <div class="hud">
              <video id="cam" playsinline muted></video>
              <div class="frame"></div>
            </div>
            <div class="k" style="margin-top:8px">Cameras / microphones (visible after permission)</div>
            <div class="v" id="devices">‚Äî</div>
            <div class="cta">
              <button class="btn ghost" onclick="startCamera()">Allow camera</button>
              <button class="btn ghost" onclick="stopCamera()">Stop camera</button>
            </div>
          </div>
          <div class="box">
            <div class="k">Geolocation (user consent)</div>
            <div class="v" id="geo">‚Äî</div>
            <div class="cta">
              <button class="btn ghost" onclick="getLocation()">Share location</button>
            </div>
          </div>
        </div>
      </details>

      <details>
        <summary>What a malicious page might attempt (we will <u>not</u>)</summary>
        <div class="box">
          <ul>
            <li><strong>Brand-impersonation:</strong> copy your bank‚Äôs look, then fish credentials.</li>
            <li><strong>Drive-by prompts:</strong> ‚Äúupdate‚Äù popups to install unsafe apps or profiles.</li>
            <li><strong>Push abuse:</strong> once allowed, push endless ‚Äúbank alerts‚Äù.</li>
            <li><strong>Session riding:</strong> click-jacking during a real session.</li>
          </ul>
          <p class="note">This is an educational demo ‚Äî no storage, no uploads, no network calls.</p>
        </div>
      </details>

      <div class="cta">
        <a class="btn primary" href="https://bixah.com/protect" target="_blank" rel="noopener">How Bixah protects you</a>
        <button class="btn ghost" onclick="location.reload()">Replay</button>
      </div>
    </main>
  </div>

<script>
  function closeIntro(){ document.getElementById('modal').classList.add('hidden'); }
  const params = new URLSearchParams(location.search);
  const mode = (params.get('mode') || 'shock').toLowerCase();
  document.getElementById('modeTag').textContent = mode === 'safe' ? 'Safe mode' : 'Shock mode';

  let mouseMoves=0, lastMove=Date.now(), idleSec=0, keyCount=0, lastKey='none';
  const bump = ()=>{ mouseMoves++; lastMove=Date.now(); };
  document.addEventListener('mousemove', bump, {passive:true});
  document.addEventListener('touchmove', bump, {passive:true});
  document.addEventListener('touchstart', bump, {passive:true});
  document.addEventListener('keydown', (e)=>{ keyCount++; lastKey=e.key; }, {passive:true});
  setInterval(()=>{
    idleSec = Math.max(0, Math.round((Date.now()-lastMove)/1000));
    byId('mouseCount').textContent = mouseMoves;
    byId('idle').textContent = idleSec;
    byId('keyCount').textContent = keyCount;
    byId('lastKey').textContent = lastKey;
  }, 300);

  function renderFacts(){
    const tz = Intl.DateTimeFormat().resolvedOptions().timeZone || 'Unknown';
    const mem = navigator.deviceMemory ? navigator.deviceMemory + ' GB (approx)' : '‚Äî';
    const cores = navigator.hardwareConcurrency || '‚Äî';
    const touch = navigator.maxTouchPoints || 0;
    const lang = navigator.languages ? navigator.languages.join(', ') : (navigator.language || '‚Äî');
    const colorDepth = screen.colorDepth ? screen.colorDepth + '-bit' : '‚Äî';
    const vendor = navigator.vendor || '‚Äî';
    const plat = navigator.platform || '‚Äî';
    const ua = navigator.userAgent || '‚Äî';
    const ref = document.referrer || '‚Äî';
    const cookies = navigator.cookieEnabled ? 'Yes' : 'No';

    addKV('facts','User agent', ua);
    addKV('facts','Platform / Vendor', `${plat} / ${vendor}`);
    addKV('facts','Languages', lang);
    addKV('facts','Time zone', tz);
    addKV('facts','Screen', `${screen.width} √ó ${screen.height} @ ${colorDepth}`);
    addKV('facts','CPU cores (hint)', cores);
    addKV('facts','Device memory (hint)', mem);
    addKV('facts','Touch support', `${touch} points`);
    addKV('facts','Cookies enabled', cookies);
    addKV('facts','Referrer', ref);
  }

  async function renderDeep(){
    const gl = getWebGLInfo();
    addKV('deep','WebGL vendor', gl.vendor || '‚Äî');
    addKV('deep','WebGL renderer', gl.renderer || '‚Äî');
    addKV('deep','WebGL extensions', (gl.extensions||[]).length ? gl.extensions.length+' supported' : '‚Äî');
    const canvasHash = await canvasFingerprint();
    addKV('deep','Canvas fingerprint (hash)', canvasHash);
    const audioHash = await audioFingerprint();
    addKV('deep','Audio fingerprint (hash)', audioHash);
    const fonts = detectFonts();
    addKV('deep','Likely fonts present', fonts.join(', ') || '‚Äî');
  }

  function renderEnv(){
    const online = navigator.onLine ? 'Online' : 'Offline';
    const prefersDark = match('(prefers-color-scheme: dark)') ? 'Dark' : 'Light';
    const reducedMotion = match('(prefers-reduced-motion: reduce)') ? 'Yes' : 'No';
    const widthClass = screen.width >= 1200 ? 'Desktop-ish' : screen.width >= 768 ? 'Tablet-ish' : 'Phone-ish';
    const historyLen = (history && typeof history.length==='number') ? history.length : '‚Äî';
    const navType = navTypeStr();
    addKV('env','Connection state', online);
    addKV('env','Theme preference', prefersDark);
    addKV('env','Reduced motion', reducedMotion);
    addKV('env','Viewport class', widthClass);
    addKV('env','History length', historyLen);
    addKV('env','Navigation type', navType);
  }

  function match(q){ try { return window.matchMedia && window.matchMedia(q).matches; } catch(e){ return false; } }
  function navTypeStr(){
    try { const n=performance.getEntriesByType('navigation'); if(n&&n.length) return n[0].type; } catch(e){}
    return '‚Äî';
  }

  let stream=null;
  async function startCamera(){
    try{
      stream = await navigator.mediaDevices.getUserMedia({ video:{facingMode:'user'}, audio:false });
      const v = byId('cam'); v.srcObject = stream; await v.play();
      listDevices();
    }catch(e){ alert('Camera denied or unavailable.'); }
  }
  function stopCamera(){
    const v = byId('cam');
    if(stream){ stream.getTracks().forEach(t=>t.stop()); stream=null; }
    v.pause(); v.srcObject=null;
  }
  async function listDevices(){
    try{
      const devs = await navigator.mediaDevices.enumerateDevices();
      const list = devs.map(d=>`${d.kind}: ${d.label||'(label hidden)'} (${d.deviceId.slice(0,8)}‚Ä¶)`).join('<br>');
      byId('devices').innerHTML = list || '‚Äî';
    }catch(e){ byId('devices').textContent='‚Äî'; }
  }
  function getLocation(){
    if(!navigator.geolocation){ byId('geo').textContent='Geolocation not supported'; return; }
    navigator.geolocation.getCurrentPosition(
      (pos)=>{
        const { latitude, longitude, accuracy } = pos.coords;
        byId('geo').textContent = `Lat: ${latitude.toFixed(6)}, Lng: ${longitude.toFixed(6)} ‚Ä¢ ¬±${Math.round(accuracy)} m`;
      },
      (err)=>{ byId('geo').textContent = 'Denied or unavailable.'; },
      { enableHighAccuracy:true, timeout:8000, maximumAge:0 }
    );
  }

  async function canvasFingerprint(){
    try{
      const c = document.createElement('canvas'); c.width=300; c.height=70;
      const ctx = c.getContext('2d');
      ctx.textBaseline='top'; ctx.font='16px "Arial"';
      ctx.fillStyle='#f60'; ctx.fillRect(125,1,62,20);
      ctx.fillStyle='#069'; ctx.fillText('Bixah canvas fp üòà', 2, 15);
      ctx.strokeStyle='rgba(120, 10, 10, 0.7)'; ctx.strokeRect(120, 10, 150, 30);
      const data = c.toDataURL();
      const buf = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(data));
      return hex(buf);
    }catch(e){ return '‚Äî'; }
  }
  async function audioFingerprint(){
    try{
      const Ctx = window.OfflineAudioContext || window.webkitOfflineAudioContext;
      if(!Ctx) return '‚Äî';
      const ctx = new Ctx(1, 22050, 22050);
      const osc = ctx.createOscillator(); osc.type='triangle'; osc.frequency.value=880;
      const comp = ctx.createDynamicsCompressor();
      osc.connect(comp); comp.connect(ctx.destination); osc.start(0);
      const buf = await ctx.startRendering();
      const chan = buf.getChannelData(0).slice(0, 4000);
      const str = Array.from(chan).map(x=>Math.round(x*1000)/1000).join(',');
      const dig = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(str));
      return hex(dig);
    }catch(e){ return '‚Äî'; }
  }
  function detectFonts(){
    const base = 'monospace,serif,sans-serif';
    const tests = ['Arial','Times New Roman','Courier New','Tahoma','Verdana','Roboto','Noto Naskh Arabic','Segoe UI'];
    const s = document.createElement('span');
    s.style.cssText='position:absolute;left:-9999px;font-size:64px;';
    s.textContent='mmmmmmmmmmlli';
    document.body.appendChild(s);
    function widthFor(f){ s.style.fontFamily=`"${f}",`+base; return s.getBoundingClientRect().width; }
    const ref = widthFor('nonexistent_font_xyz');
    const found = tests.filter(f=>Math.abs(widthFor(f)-ref)>0.1);
    document.body.removeChild(s);
    return found;
  }
  function getWebGLInfo(){
    try{
      const canvas = document.createElement('canvas');
      const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
      if(!gl) return {};
      const exts = gl.getSupportedExtensions()||[];
      const dbg = gl.getExtension('WEBGL_debug_renderer_info');
      return dbg ? {
        vendor: gl.getParameter(dbg.UNMASKED_VENDOR_WEBGL),
        renderer: gl.getParameter(dbg.UNMASKED_RENDERER_WEBGL),
        extensions: exts
      } : { extensions: exts, renderer:'WebGL enabled (details masked)' };
    }catch(e){ return {}; }
  }

  function addKV(containerId,k,v){
    const div = document.createElement('div'); div.className='box';
    div.innerHTML = `<div class="k">${escapeHtml(k)}</div><div class="v">${escapeHtml(v)}</div>`;
    byId(containerId).appendChild(div);
  }
  function byId(id){ return document.getElementById(id); }
  function escapeHtml(x){ return String(x).replace(/[&<>"']/g,s=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[s])); }
  function hex(buf){ return [...new Uint8Array(buf)].map(b=>b.toString(16).padStart(2,'0')).join(''); }

  window.addEventListener('load', ()=>{
    renderFacts(); renderDeep(); renderEnv();
    if(navigator.mediaDevices && navigator.mediaDevices.enumerateDevices){ listDevices(); }
  });
</script>
</body>
</html>
